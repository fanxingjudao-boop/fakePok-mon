<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#667eea">
    <title>Monster Quest - ç©¶æ¥µã®å†’é™º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            overflow-x: hidden;
            overflow-y: auto;
            touch-action: pan-y;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', sans-serif;
            background: #1a1a2e;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0) rotate(0deg); }
            25% { transform: translateX(-10px) rotate(-5deg); }
            75% { transform: translateX(10px) rotate(5deg); }
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
        }
        
        @keyframes sparkle {
            0%, 100% { opacity: 0; transform: scale(0); }
            50% { opacity: 1; transform: scale(1); }
        }
        
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
            50% { box-shadow: 0 0 40px rgba(255, 215, 0, 0.8); }
        }
        
        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
        .slide-in { animation: slideIn 0.4s ease-out forwards; }
        .shake { animation: shake 0.5s ease-in-out; }
        .bounce { animation: bounce 2s ease-in-out infinite; }
        .pulse { animation: pulse 2s ease-in-out infinite; }
        .glow { animation: glow 2s ease-in-out infinite; }
        
        .monster-sprite {
            position: relative;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .monster-sprite::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 120%;
            height: 120%;
            transform: translate(-50%, -50%);
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .monster-sprite:hover::before {
            opacity: 0.3;
        }
        
        .button-press {
            transition: all 0.1s;
        }
        
        .button-press:active {
            transform: scale(0.95);
        }
        
        .hp-bar-container {
            position: relative;
            overflow: hidden;
        }
        
        .hp-bar-shine {
            position: absolute;
            top: 0;
            left: -100%;
            width: 30%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shine 3s infinite;
        }
        
        @keyframes shine {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .map-tile {
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .map-tile:hover {
            transform: scale(1.05);
            filter: brightness(1.2);
        }
        
        .text-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ============ ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ ============
        
        const MONSTER_DATABASE = {
          // ç‚ã‚¿ã‚¤ãƒ— - 10ç¨®é¡
          1: { id: 1, name: 'ãƒ’ãƒã‚³', type: 'fire', baseHP: 25, baseAtk: 40, baseDef: 32, evolvesTo: 2, evolveLevel: 10, sprite: 'ğŸ¦', rarity: 'common' },
          2: { id: 2, name: 'ãƒ•ãƒ¬ã‚¤ã‚¶ãƒ¼ãƒ‰', type: 'fire', baseHP: 38, baseAtk: 52, baseDef: 45, evolvesTo: 3, evolveLevel: 25, sprite: 'ğŸ‰', rarity: 'uncommon' },
          3: { id: 3, name: 'ã‚¤ãƒ³ãƒ•ã‚§ãƒ«ãƒãƒ‰ãƒ©ã‚´ãƒ³', type: 'fire', baseHP: 55, baseAtk: 75, baseDef: 60, evolvesTo: null, evolveLevel: null, sprite: 'ğŸ”¥', rarity: 'rare' },
          4: { id: 4, name: 'ãƒ›ãƒ ãƒ©', type: 'fire', baseHP: 28, baseAtk: 45, baseDef: 28, evolvesTo: 5, evolveLevel: 12, sprite: 'ğŸŒ‹', rarity: 'common' },
          5: { id: 5, name: 'ãƒã‚°ãƒãƒ­ãƒ³', type: 'fire', baseHP: 50, baseAtk: 80, baseDef: 52, evolvesTo: null, evolveLevel: null, sprite: 'ğŸŒ¶ï¸', rarity: 'rare' },
          6: { id: 6, name: 'ã‚¹ãƒ‘ãƒ¼ã‚­ãƒ¼', type: 'fire', baseHP: 30, baseAtk: 48, baseDef: 35, evolvesTo: 7, evolveLevel: 15, sprite: 'âœ¨', rarity: 'uncommon' },
          7: { id: 7, name: 'ãƒ•ã‚§ãƒ‹ãƒƒã‚¯ã‚¹', type: 'fire', baseHP: 52, baseAtk: 85, baseDef: 55, evolvesTo: null, evolveLevel: null, sprite: 'ğŸ¦…', rarity: 'legendary' },
          8: { id: 8, name: 'ã‚³ãƒ­ãƒŠ', type: 'fire', baseHP: 26, baseAtk: 42, baseDef: 30, evolvesTo: 9, evolveLevel: 11, sprite: 'â˜€ï¸', rarity: 'common' },
          9: { id: 9, name: 'ã‚½ãƒ¼ãƒ©ãƒ¼ã‚­ãƒ³ã‚°', type: 'fire', baseHP: 48, baseAtk: 78, baseDef: 58, evolvesTo: null, evolveLevel: null, sprite: 'ğŸ‘‘', rarity: 'rare' },
          10: { id: 10, name: 'ãƒœãƒ«ã‚±ãƒ¼ãƒ', type: 'fire', baseHP: 60, baseAtk: 90, baseDef: 65, evolvesTo: null, evolveLevel: null, sprite: 'ğŸ’¥', rarity: 'legendary' },
          
          // æ°´ã‚¿ã‚¤ãƒ— - 10ç¨®é¡
          11: { id: 11, name: 'ãƒŸã‚ºã‚¿ãƒ', type: 'water', baseHP: 30, baseAtk: 35, baseDef: 48, evolvesTo: 12, evolveLevel: 10, sprite: 'ğŸ’§', rarity: 'common' },
          12: { id: 12, name: 'ã‚¢ã‚¯ã‚¢ã‚¿ãƒ¼ãƒˆãƒ«', type: 'water', baseHP: 42, baseAtk: 50, baseDef: 62, evolvesTo: 13, evolveLevel: 25, sprite: 'ğŸ¢', rarity: 'uncommon' },
          13: { id: 13, name: 'ã‚ªãƒ¼ã‚·ãƒ£ãƒ³ãƒ­ãƒ¼ãƒ‰', type: 'water', baseHP: 60, baseAtk: 68, baseDef: 80, evolvesTo: null, evolveLevel: null, sprite: 'ğŸŒŠ', rarity: 'rare' },
          14: { id: 14, name: 'ãƒ•ã‚£ãƒ³', type: 'water', baseHP: 32, baseAtk: 42, baseDef: 42, evolvesTo: 15, evolveLevel: 12, sprite: 'ğŸŸ', rarity: 'common' },
          15: { id: 15, name: 'ã‚·ãƒ£ãƒ¼ã‚¯', type: 'water', baseHP: 48, baseAtk: 72, baseDef: 65, evolvesTo: null, evolveLevel: null, sprite: 'ğŸ¦ˆ', rarity: 'rare' },
          16: { id: 16, name: 'ãƒ‰ãƒ«ãƒ•ã‚£', type: 'water', baseHP: 35, baseAtk: 45, baseDef: 45, evolvesTo: 17, evolveLevel: 15, sprite: 'ğŸ¬', rarity: 'uncommon' },
          17: { id: 17, name: 'ãƒãƒ—ãƒãƒ¥ãƒ¼ãƒ³', type: 'water', baseHP: 55, baseAtk: 75, baseDef: 70, evolvesTo: null, evolveLevel: null, sprite: 'ğŸ”±', rarity: 'legendary' },
          18: { id: 18, name: 'ãƒãƒ–ãƒ«', type: 'water', baseHP: 28, baseAtk: 38, baseDef: 40, evolvesTo: 19, evolveLevel: 11, sprite: 'ğŸ«§', rarity: 'common' },
          19: { id: 19, name: 'ã‚¯ãƒªã‚¹ã‚¿ãƒ«', type: 'water', baseHP: 50, baseAtk: 70, baseDef: 75, evolvesTo: null, evolveLevel: null, sprite: 'ğŸ’', rarity: 'rare' },
          20: { id: 20, name: 'ãƒªãƒ´ã‚¡ã‚¤ã‚¢ã‚µãƒ³', type: 'water', baseHP: 65, baseAtk: 82, baseDef: 88, evolvesTo: null, evolveLevel: null, sprite: 'ğŸ‹', rarity: 'legendary' },
          
          // è‰ã‚¿ã‚¤ãƒ— - 10ç¨®é¡
          21: { id: 21, name: 'ã‚¯ã‚µãƒãƒ¡', type: 'grass', baseHP: 32, baseAtk: 38, baseDef: 38, evolvesTo: 22, evolveLevel: 10, sprite: 'ğŸŒ±', rarity: 'common' },
          22: { id: 22, name: 'ã‚°ãƒªãƒ¼ãƒ³ãƒ•ãƒ©ãƒ¯ãƒ¼', type: 'grass', baseHP: 44, baseAtk: 52, baseDef: 52, evolvesTo: 23, evolveLevel: 25, sprite: 'ğŸŒ»', rarity: 'uncommon' },
          23: { id: 23, name: 'ãƒ•ã‚©ãƒ¬ã‚¹ãƒˆã‚­ãƒ³ã‚°', type: 'grass', baseHP: 58, baseAtk: 70, baseDef: 68, evolvesTo: null, evolveLevel: null, sprite: 'ğŸŒ³', rarity: 'rare' },
          24: { id: 24, name: 'ãƒªãƒ¼ãƒ•', type: 'grass', baseHP: 33, baseAtk: 42, baseDef: 40, evolvesTo: 25, evolveLevel: 12, sprite: 'ğŸƒ', rarity: 'common' },
          25: { id: 25, name: 'ã‚¸ãƒ£ãƒ³ã‚°ãƒ©ãƒ¼', type: 'grass', baseHP: 52, baseAtk: 76, baseDef: 62, evolvesTo: null, evolveLevel: null, sprite: 'ğŸŒ´', rarity: 'rare' },
          26: { id: 26, name: 'ãƒãƒƒã‚·ãƒ¥', type: 'grass', baseHP: 30, baseAtk: 40, baseDef: 45, evolvesTo: 27, evolveLevel: 15, sprite: 'ğŸ„', rarity: 'uncommon' },
          27: { id: 27, name: 'ã‚¬ãƒ¼ãƒ‡ã‚£ã‚¢ãƒ³', type: 'grass', baseHP: 54, baseAtk: 68, baseDef: 78, evolvesTo: null, evolveLevel: null, sprite: 'ğŸŒ²', rarity: 'legendary' },
          28: { id: 28, name: 'ãƒ•ãƒ©ãƒ¯ãƒ¼', type: 'grass', baseHP: 29, baseAtk: 36, baseDef: 42, evolvesTo: 29, evolveLevel: 11, sprite: 'ğŸŒ¸', rarity: 'common' },
          29: { id: 29, name: 'ãƒ–ãƒ­ãƒƒã‚µãƒ ', type: 'grass', baseHP: 48, baseAtk: 65, baseDef: 72, evolvesTo: null, evolveLevel: null, sprite: 'ğŸŒº', rarity: 'rare' },
          30: { id: 30, name: 'ã‚¨ãƒ«ãƒ€ãƒ¼ãƒ„ãƒªãƒ¼', type: 'grass', baseHP: 62, baseAtk: 78, baseDef: 85, evolvesTo: null, evolveLevel: null, sprite: 'ğŸ„', rarity: 'legendary' },
        };

        const MOVES_DATABASE = {
          fire: [
            { name: 'ã²ã£ã‹ã', power: 30, type: 'normal', level: 1, effect: null },
            { name: 'ã²ã®ã“', power: 35, type: 'fire', level: 1, effect: null },
            { name: 'ã»ã®ãŠã®ã‚­ãƒ', power: 55, type: 'fire', level: 14, effect: null },
            { name: 'ã‹ãˆã‚“ã»ã†ã—ã‚ƒ', power: 75, type: 'fire', level: 20, effect: null },
            { name: 'ã ã„ã‚‚ã‚“ã˜', power: 95, type: 'fire', level: 30, effect: null }
          ],
          water: [
            { name: 'ãŸã„ã‚ãŸã‚Š', power: 30, type: 'normal', level: 1, effect: null },
            { name: 'ã¿ãšã§ã£ã½ã†', power: 35, type: 'water', level: 1, effect: null },
            { name: 'ã‚¢ã‚¯ã‚¢ã‚¸ã‚§ãƒƒãƒˆ', power: 55, type: 'water', level: 14, effect: null },
            { name: 'ãªã¿ã®ã‚Š', power: 75, type: 'water', level: 20, effect: null },
            { name: 'ãƒã‚¤ãƒ‰ãƒ­ãƒãƒ³ãƒ—', power: 95, type: 'water', level: 30, effect: null }
          ],
          grass: [
            { name: 'ã¤ã‚‹ã®ãƒ ãƒ', power: 35, type: 'grass', level: 1, effect: null },
            { name: 'ã¯ã£ã±ã‚«ãƒƒã‚¿ãƒ¼', power: 45, type: 'grass', level: 1, effect: null },
            { name: 'ã©ãã®ã“ãª', power: 0, type: 'grass', level: 10, effect: 'poison' },
            { name: 'ã—ã³ã‚Œã”ãª', power: 0, type: 'grass', level: 12, effect: 'paralyze' },
            { name: 'ã¯ãªã³ã‚‰ã®ã¾ã„', power: 80, type: 'grass', level: 22, effect: null },
            { name: 'ã‚½ãƒ¼ãƒ©ãƒ¼ãƒ“ãƒ¼ãƒ ', power: 100, type: 'grass', level: 30, effect: null }
          ]
        };

        const TYPE_CHART = {
          fire: { grass: 2, water: 0.5, fire: 1, normal: 1 },
          water: { fire: 2, grass: 0.5, water: 1, normal: 1 },
          grass: { water: 2, fire: 0.5, grass: 1, normal: 1 },
          normal: { fire: 1, water: 1, grass: 1, normal: 1 }
        };

        const ITEMS = {
          potion: { name: 'ã‚­ã‚ºãã™ã‚Š', price: 200, heal: 20, description: 'HPã‚’20å›å¾©' },
          superPotion: { name: 'ã„ã„ã‚­ã‚ºãã™ã‚Š', price: 700, heal: 50, description: 'HPã‚’50å›å¾©' },
          hyperPotion: { name: 'ã™ã”ã„ã‚­ã‚ºãã™ã‚Š', price: 1500, heal: 100, description: 'HPã‚’100å›å¾©' },
          antidote: { name: 'ã©ãã‘ã—', price: 100, cure: 'poison', description: 'æ¯’ã‚’æ²»ã™' },
          awakening: { name: 'ã­ã‚€ã‘ã–ã¾ã—', price: 200, cure: 'sleep', description: 'çœ ã‚Šã‚’æ²»ã™' },
          paralyzHeal: { name: 'ã¾ã²ãªãŠã—', price: 200, cure: 'paralyze', description: 'éº»ç—ºã‚’æ²»ã™' },
          fullHeal: { name: 'ãªã‚“ã§ã‚‚ãªãŠã—', price: 600, cure: 'all', description: 'å…¨çŠ¶æ…‹ç•°å¸¸ã‚’æ²»ã™' }
        };

        // ãƒãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿
        const WORLD_MAP = {
          towns: [
            { 
              id: 'meadow', 
              name: 'ã¿ã©ã‚Šã®æ‘', 
              description: 'å†’é™ºã®å§‹ã¾ã‚Šã®å ´æ‰€ã€‚å¹³å’Œãªæ‘ã€‚',
              sprite: 'ğŸ¡',
              position: { x: 1, y: 2 }
            },
            { 
              id: 'forest', 
              name: 'ã‚‚ã‚Šã®ç”º', 
              description: 'æ·±ã„æ£®ã«å›²ã¾ã‚ŒãŸç”ºã€‚',
              sprite: 'ğŸŒ²',
              position: { x: 2, y: 1 }
            },
            { 
              id: 'lake', 
              name: 'ã¿ãšã†ã¿ã®ç”º', 
              description: 'ç¾ã—ã„æ¹–ã®ã»ã¨ã‚Šã®ç”ºã€‚',
              sprite: 'ğŸï¸',
              position: { x: 3, y: 2 }
            },
            { 
              id: 'mountain', 
              name: 'ã‚„ã¾ã®ç”º', 
              description: 'é™ºã—ã„å±±ã®éº“ã®ç”ºã€‚',
              sprite: 'â›°ï¸',
              position: { x: 2, y: 3 }
            },
            { 
              id: 'castle', 
              name: 'ãŠã†ã˜ã‚‡ã†ã®åŸ', 
              description: 'ãƒãƒ£ãƒ³ãƒ”ã‚ªãƒ³ãŒå¾…ã¤å ´æ‰€ã€‚',
              sprite: 'ğŸ°',
              position: { x: 4, y: 2 }
            }
          ],
          routes: [
            { 
              id: 'route1', 
              name: '1ã°ã‚“ã©ã†ã‚', 
              from: 'meadow', 
              to: 'forest', 
              enemies: [1, 11, 21], 
              minLevel: 3, 
              maxLevel: 7,
              sprite: 'ğŸ›¤ï¸'
            },
            { 
              id: 'route2', 
              name: '2ã°ã‚“ã©ã†ã‚', 
              from: 'forest', 
              to: 'lake', 
              enemies: [2, 12, 22, 4, 14], 
              minLevel: 10, 
              maxLevel: 16,
              sprite: 'ğŸŒ¿'
            },
            { 
              id: 'route3', 
              name: '3ã°ã‚“ã©ã†ã‚', 
              from: 'lake', 
              to: 'mountain', 
              enemies: [3, 13, 23, 5, 15, 25], 
              minLevel: 20, 
              maxLevel: 28,
              sprite: 'ğŸ”ï¸'
            },
            { 
              id: 'route4', 
              name: 'ãƒãƒ£ãƒ³ãƒ”ã‚ªãƒ³ãƒ­ãƒ¼ãƒ‰', 
              from: 'mountain', 
              to: 'castle', 
              enemies: [7, 17, 27, 10, 20, 30], 
              minLevel: 30, 
              maxLevel: 38,
              sprite: 'âš”ï¸'
            }
          ],
          rivals: [
            { id: 'rival1', name: 'ãƒ©ã‚¤ãƒãƒ« ã‚¿ã‚¯ãƒŸ', location: 'forest', monster: 2, level: 12, reward: 600, sprite: 'ğŸ‘¦', message: 'ã‚„ã‚ï¼ã¼ããŒå…ˆã«å¼·ããªã£ã¦ã‚„ã‚‹ï¼' },
            { id: 'rival2', name: 'ã‚¨ãƒªãƒ¼ãƒˆ ã‚¢ã‚«ãƒ', location: 'lake', monster: 12, level: 22, reward: 1200, sprite: 'ğŸ‘§', message: 'ã‚ãªãŸã®å®ŸåŠ›ã€è¦‹ã›ã¦ã‚‚ã‚‰ã†ã‚ï¼' },
            { id: 'rival3', name: 'ãƒªãƒ¼ãƒ€ãƒ¼ ã‚±ãƒ³ã‚¸', location: 'mountain', monster: 22, level: 32, reward: 2000, sprite: 'ğŸ§‘', message: 'ã“ã“ã¾ã§æ¥ã‚‹ã¨ã¯...æœ¬æ°—ã§è¡Œããï¼' },
            { id: 'champion', name: 'ãƒãƒ£ãƒ³ãƒ”ã‚ªãƒ³ ãƒ¬ã‚¤ãƒŠ', location: 'castle', monster: 30, level: 45, reward: 10000, sprite: 'ğŸ‘‘', message: 'é ‚ç‚¹ã‚’ç›®æŒ‡ã™è€…ã‚ˆã€ãã®åŠ›è¦‹ã›ã¦ã‚‚ã‚‰ãŠã†ï¼' }
          ],
          events: [
            {
              id: 'oldman1',
              location: 'meadow',
              npc: 'è€äºº',
              sprite: 'ğŸ‘´',
              message: 'å†’é™ºã«å‡ºã‚‹ã®ã‹ã„ï¼Ÿå±é™ºã ãŒã€ãã£ã¨ç´ æ™´ã‚‰ã—ã„çµŒé¨“ã«ãªã‚‹ãï¼',
              reward: null
            },
            {
              id: 'girl1',
              location: 'forest',
              npc: 'è¿·å­ã®å°‘å¥³',
              sprite: 'ğŸ‘§',
              message: 'ã‚ãªãŸã€å¼·ãã†ã­...æ€–ã„ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼å€’ã—ã¦ãã‚ŒãŸã‚‰ã€ã“ã‚Œã‚ã’ã‚‹ï¼',
              reward: { item: 'superPotion', amount: 2 }
            },
            {
              id: 'fisherman',
              location: 'lake',
              npc: 'é‡£ã‚Šäºº',
              sprite: 'ğŸ£',
              message: 'ã“ã®æ¹–ã«ã¯çã—ã„ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ãŒã„ã‚‹ã‚“ã ã€‚è¦‹ã¤ã‘ãŸã‚‰æ•™ãˆã¦ãã‚Œã‚ˆï¼',
              reward: { money: 500 }
            },
            {
              id: 'hiker',
              location: 'mountain',
              npc: 'ç™»å±±å®¶',
              sprite: 'ğŸ¥¾',
              message: 'å±±ã‚’ç™»ã‚Šãã£ãŸè€…ã ã‘ãŒåŸã«ãŸã©ã‚Šç€ã‘ã‚‹ã€‚é ‘å¼µã‚Œï¼',
              reward: { item: 'hyperPotion', amount: 3 }
            }
          ]
        };

        // ============ ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ ============
        
        const MonsterQuest = () => {
          const [screen, setScreen] = useState('title');
          const [currentLocation, setCurrentLocation] = useState('meadow');
          const [playerMonster, setPlayerMonster] = useState(null);
          const [enemyMonster, setEnemyMonster] = useState(null);
          const [battleLog, setBattleLog] = useState([]);
          const [isPlayerTurn, setIsPlayerTurn] = useState(true);
          const [money, setMoney] = useState(3000);
          const [inventory, setInventory] = useState({});
          const [defeatedRivals, setDefeatedRivals] = useState([]);
          const [completedEvents, setCompletedEvents] = useState([]);
          const [isAnimating, setIsAnimating] = useState(false);
          const [damageFlash, setDamageFlash] = useState(null);
          const [showEvolution, setShowEvolution] = useState(false);
          const [evolutionData, setEvolutionData] = useState(null);
          const [battleType, setBattleType] = useState('wild');
          const [currentRival, setCurrentRival] = useState(null);
          const [showOptions, setShowOptions] = useState(false);
          const [showMap, setShowMap] = useState(false);
          const [selectedAction, setSelectedAction] = useState(null);
          const battleLogRef = useRef(null);

          useEffect(() => {
            const saved = localStorage.getItem('monsterQuestSaveV3');
            if (saved) {
              try {
                const data = JSON.parse(saved);
                if (data.playerMonster) {
                  setPlayerMonster(data.playerMonster);
                  setMoney(data.money || 3000);
                  setInventory(data.inventory || {});
                  setCurrentLocation(data.location || 'meadow');
                  setDefeatedRivals(data.defeatedRivals || []);
                  setCompletedEvents(data.completedEvents || []);
                  setScreen('town');
                }
              } catch (e) {
                console.error('Save data corrupted');
              }
            }
          }, []);

          useEffect(() => {
            if (battleLogRef.current) {
              battleLogRef.current.scrollTop = battleLogRef.current.scrollHeight;
            }
          }, [battleLog]);

          const saveGame = (monster, loc, mon, inv, rivals, events) => {
            localStorage.setItem('monsterQuestSaveV3', JSON.stringify({
              playerMonster: monster,
              money: mon,
              inventory: inv,
              location: loc,
              defeatedRivals: rivals,
              completedEvents: events
            }));
          };

          const createMonster = (monsterId, level = 1) => {
            const baseData = MONSTER_DATABASE[monsterId];
            const hpBonus = (level - 1) * 3;
            const atkBonus = (level - 1) * 4;
            const defBonus = (level - 1) * 2;
            
            const maxHP = baseData.baseHP + hpBonus;
            const moves = MOVES_DATABASE[baseData.type].filter(m => m.level <= level).slice(-4);
            
            return {
              ...baseData,
              level,
              exp: 0,
              expToNext: level * 80,
              currentHP: maxHP,
              maxHP,
              attack: baseData.baseAtk + atkBonus,
              defense: baseData.baseDef + defBonus,
              moves,
              status: null
            };
          };

          const selectStarter = (monsterId) => {
            const monster = createMonster(monsterId, 5);
            setPlayerMonster(monster);
            setCurrentLocation('meadow');
            saveGame(monster, 'meadow', 3000, {}, [], []);
            setScreen('story-intro');
          };

          const startWildBattle = (routeId) => {
            const route = WORLD_MAP.routes.find(r => r.id === routeId);
            const enemyId = route.enemies[Math.floor(Math.random() * route.enemies.length)];
            const enemyLevel = Math.floor(Math.random() * (route.maxLevel - route.minLevel + 1)) + route.minLevel;
            
            const enemy = createMonster(enemyId, enemyLevel);
            setEnemyMonster(enemy);
            setBattleType('wild');
            setCurrentRival(null);
            setBattleLog([`é‡ç”Ÿã®${enemy.name}ãŒç¾ã‚ŒãŸï¼`]);
            setIsPlayerTurn(true);
            setSelectedAction(null);
            setScreen('battle');
          };

          const startRivalBattle = (rivalId) => {
            const rival = WORLD_MAP.rivals.find(r => r.id === rivalId);
            const enemy = createMonster(rival.monster, rival.level);
            setEnemyMonster(enemy);
            setBattleType(rivalId === 'champion' ? 'champion' : 'rival');
            setCurrentRival(rival);
            setBattleLog([`${rival.name}ãŒå‹è² ã‚’ä»•æ›ã‘ã¦ããŸï¼`, rival.message]);
            setIsPlayerTurn(true);
            setSelectedAction(null);
            setScreen('battle');
          };

          const calculateDamage = (attacker, defender, move) => {
            if (move.power === 0) return { damage: 0, effectiveness: 1 };
            
            const effectiveness = TYPE_CHART[move.type][defender.type];
            const baseDamage = ((attacker.attack * move.power / defender.defense) / 5) * effectiveness;
            const randomFactor = 0.85 + Math.random() * 0.15;
            const damage = Math.max(1, Math.floor(baseDamage * randomFactor));
            return { damage, effectiveness };
          };

          const applyStatus = (target, effect) => {
            if (target.status) return target;
            
            const chance = effect === 'poison' ? 0.3 : effect === 'paralyze' ? 0.25 : 0.2;
            if (Math.random() < chance) {
              return { ...target, status: effect };
            }
            return target;
          };

          const checkStatus = (monster) => {
            if (monster.status === 'poison') {
              const damage = Math.floor(monster.maxHP / 8);
              return { damage, canMove: true, message: `${monster.name}ã¯æ¯’ã®ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’å—ã‘ãŸï¼` };
            } else if (monster.status === 'paralyze') {
              const canMove = Math.random() > 0.25;
              return { damage: 0, canMove, message: canMove ? '' : `${monster.name}ã¯ä½“ãŒç—ºã‚Œã¦å‹•ã‘ãªã„ï¼` };
            } else if (monster.status === 'sleep') {
              const wakeUp = Math.random() > 0.5;
              if (wakeUp) {
                return { damage: 0, canMove: true, message: `${monster.name}ã¯ç›®ã‚’è¦šã¾ã—ãŸï¼`, removeStatus: true };
              }
              return { damage: 0, canMove: false, message: `${monster.name}ã¯çœ ã£ã¦ã„ã‚‹...` };
            }
            return { damage: 0, canMove: true, message: '' };
          };

          const playerAttack = (move) => {
            if (isAnimating || !isPlayerTurn) return;
            
            setIsAnimating(true);
            setSelectedAction('attack');
            
            const statusCheck = checkStatus(playerMonster);
            if (statusCheck.message) {
              setBattleLog(prev => [...prev, statusCheck.message]);
            }
            
            if (statusCheck.removeStatus) {
              setPlayerMonster(prev => ({ ...prev, status: null }));
            }
            
            if (!statusCheck.canMove) {
              setTimeout(() => {
                if (statusCheck.damage > 0) {
                  const newHP = Math.max(0, playerMonster.currentHP - statusCheck.damage);
                  setPlayerMonster(prev => ({ ...prev, currentHP: newHP }));
                }
                setIsPlayerTurn(false);
                setTimeout(() => enemyAttack(), 1500);
              }, 1500);
              return;
            }
            
            const { damage, effectiveness } = calculateDamage(playerMonster, enemyMonster, move);
            
            let newEnemy = { ...enemyMonster, currentHP: Math.max(0, enemyMonster.currentHP - damage) };
            
            if (move.effect) {
              newEnemy = applyStatus(newEnemy, move.effect);
            }
            
            setEnemyMonster(newEnemy);
            setDamageFlash('enemy');
            
            let messages = [`${playerMonster.name}ã®${move.name}ï¼`];
            if (damage > 0) messages.push(`${damage}ã®ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼`);
            if (effectiveness === 2) messages.push('åŠ¹æœã¯æŠœç¾¤ã ï¼');
            else if (effectiveness === 0.5) messages.push('åŠ¹æœã¯ã„ã¾ã²ã¨ã¤ã ...');
            if (move.effect && newEnemy.status === move.effect) {
              const statusName = move.effect === 'poison' ? 'æ¯’' : move.effect === 'paralyze' ? 'éº»ç—º' : 'çœ ã‚Š';
              messages.push(`${enemyMonster.name}ã¯${statusName}çŠ¶æ…‹ã«ãªã£ãŸï¼`);
            }
            
            setBattleLog(prev => [...prev, ...messages]);
            
            setTimeout(() => {
              setDamageFlash(null);
              
              if (statusCheck.damage > 0) {
                const newHP = Math.max(0, playerMonster.currentHP - statusCheck.damage);
                setPlayerMonster(prev => ({ ...prev, currentHP: newHP }));
              }
              
              if (newEnemy.currentHP === 0) {
                handleVictory();
              } else {
                setIsPlayerTurn(false);
                setTimeout(() => enemyAttack(), 1500);
              }
            }, 800);
          };

          const enemyAttack = () => {
            const statusCheck = checkStatus(enemyMonster);
            if (statusCheck.message) {
              setBattleLog(prev => [...prev, statusCheck.message]);
            }
            
            if (statusCheck.removeStatus) {
              setEnemyMonster(prev => ({ ...prev, status: null }));
            }
            
            if (!statusCheck.canMove) {
              setTimeout(() => {
                if (statusCheck.damage > 0) {
                  const newHP = Math.max(0, enemyMonster.currentHP - statusCheck.damage);
                  setEnemyMonster(prev => ({ ...prev, currentHP: newHP }));
                  
                  if (newHP === 0) {
                    handleVictory();
                    return;
                  }
                }
                setIsPlayerTurn(true);
                setIsAnimating(false);
                setSelectedAction(null);
              }, 1500);
              return;
            }
            
            const move = enemyMonster.moves[Math.floor(Math.random() * enemyMonster.moves.length)];
            const { damage } = calculateDamage(enemyMonster, playerMonster, move);
            
            const newPlayerHP = Math.max(0, playerMonster.currentHP - damage);
            setPlayerMonster(prev => ({ ...prev, currentHP: newPlayerHP }));
            setDamageFlash('player');
            
            setBattleLog(prev => [...prev, `${enemyMonster.name}ã®${move.name}ï¼`, `${damage}ã®ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’å—ã‘ãŸï¼`]);
            
            setTimeout(() => {
              setDamageFlash(null);
              
              if (statusCheck.damage > 0) {
                const newHP = Math.max(0, enemyMonster.currentHP - statusCheck.damage);
                setEnemyMonster(prev => ({ ...prev, currentHP: newHP }));
                
                if (newHP === 0) {
                  handleVictory();
                  return;
                }
              }
              
              if (newPlayerHP === 0) {
                setBattleLog(prev => [...prev, `${playerMonster.name}ã¯å€’ã‚ŒãŸ...`]);
                setTimeout(() => {
                  setScreen('gameover');
                  setIsAnimating(false);
                  setSelectedAction(null);
                }, 2000);
              } else {
                setIsPlayerTurn(true);
                setIsAnimating(false);
                setSelectedAction(null);
              }
            }, 800);
          };

          const handleVictory = () => {
            setTimeout(() => {
              let reward = enemyMonster.level * 50;
              
              if (battleType === 'rival' || battleType === 'champion') {
                reward = currentRival.reward;
                setBattleLog(prev => [...prev, `${enemyMonster.name}ã‚’å€’ã—ãŸï¼`, `${reward}å††ã‚’æ‰‹ã«å…¥ã‚ŒãŸï¼`]);
                setDefeatedRivals(prev => {
                  const updated = [...prev, currentRival.id];
                  
                  if (battleType === 'champion') {
                    setTimeout(() => {
                      setScreen('ending');
                      setSelectedAction(null);
                    }, 3000);
                    return updated;
                  } else {
                    const newMoney = money + reward;
                    setMoney(newMoney);
                    const clearedMonster = { ...playerMonster, status: null };
                    setPlayerMonster(clearedMonster);
                    saveGame(clearedMonster, currentLocation, newMoney, inventory, updated, completedEvents);
                    setTimeout(() => {
                      setScreen('town');
                      setIsAnimating(false);
                      setSelectedAction(null);
                    }, 3000);
                    return updated;
                  }
                });
              } else {
                const expGained = enemyMonster.level * 40;
                const newMoney = money + reward;
                setMoney(newMoney);
                
                const newExp = playerMonster.exp + expGained;
                setBattleLog(prev => [...prev, `${enemyMonster.name}ã‚’å€’ã—ãŸï¼`, `${expGained}ã®çµŒé¨“å€¤ã‚’å¾—ãŸï¼`, `${reward}å††ã‚’æ‰‹ã«å…¥ã‚ŒãŸï¼`]);
                
                if (newExp >= playerMonster.expToNext) {
                  levelUp(expGained, newMoney);
                } else {
                  const updatedMonster = { ...playerMonster, exp: newExp, status: null };
                  setPlayerMonster(updatedMonster);
                  saveGame(updatedMonster, currentLocation, newMoney, inventory, defeatedRivals, completedEvents);
                  
                  setTimeout(() => {
                    setScreen('town');
                    setIsAnimating(false);
                    setSelectedAction(null);
                  }, 3000);
                }
              }
            }, 1000);
          };

          const levelUp = (expGained, currentMoney) => {
            const newLevel = playerMonster.level + 1;
            const newMaxHP = playerMonster.maxHP + 3;
            const newAttack = playerMonster.attack + 4;
            const newDefense = playerMonster.defense + 2;
            const newExpToNext = newLevel * 80;
            const remainingExp = (playerMonster.exp + expGained) - playerMonster.expToNext;
            
            const newMoves = MOVES_DATABASE[playerMonster.type].filter(m => m.level <= newLevel).slice(-4);
            
            let updatedMonster = {
              ...playerMonster,
              level: newLevel,
              exp: remainingExp,
              expToNext: newExpToNext,
              currentHP: Math.min(playerMonster.currentHP + 3, newMaxHP),
              maxHP: newMaxHP,
              attack: newAttack,
              defense: newDefense,
              moves: newMoves,
              status: null
            };
            
            setBattleLog(prev => [...prev, `${playerMonster.name}ã¯ãƒ¬ãƒ™ãƒ«${newLevel}ã«ãªã£ãŸï¼`]);
            
            if (playerMonster.evolvesTo && newLevel >= playerMonster.evolveLevel) {
              setTimeout(() => {
                evolveMonster(updatedMonster, currentMoney);
              }, 2000);
            } else {
              setPlayerMonster(updatedMonster);
              saveGame(updatedMonster, currentLocation, currentMoney, inventory, defeatedRivals, completedEvents);
              
              setTimeout(() => {
                setScreen('town');
                setIsAnimating(false);
                setSelectedAction(null);
              }, 3000);
            }
          };

          const evolveMonster = (monster, currentMoney) => {
            const evolvedData = MONSTER_DATABASE[monster.evolvesTo];
            setEvolutionData({ from: monster, to: evolvedData });
            setShowEvolution(true);
            
            setTimeout(() => {
              const hpBonus = (monster.level - 1) * 3;
              const atkBonus = (monster.level - 1) * 4;
              const defBonus = (monster.level - 1) * 2;
              
              const hpIncrease = (evolvedData.baseHP - MONSTER_DATABASE[monster.id].baseHP);
              
              const evolvedMonster = {
                ...monster,
                ...evolvedData,
                maxHP: evolvedData.baseHP + hpBonus,
                currentHP: Math.min(monster.currentHP + hpIncrease, evolvedData.baseHP + hpBonus),
                attack: evolvedData.baseAtk + atkBonus,
                defense: evolvedData.baseDef + defBonus
              };
              
              setPlayerMonster(evolvedMonster);
              saveGame(evolvedMonster, currentLocation, currentMoney, inventory, defeatedRivals, completedEvents);
              
              setTimeout(() => {
                setShowEvolution(false);
                setScreen('town');
                setIsAnimating(false);
                setSelectedAction(null);
              }, 4000);
            }, 3000);
          };

          const useItem = (itemKey) => {
            const item = ITEMS[itemKey];
            if (!inventory[itemKey] || inventory[itemKey] <= 0) return;
            
            let updated = { ...playerMonster };
            let message = '';
            
            if (item.heal) {
              const newHP = Math.min(updated.maxHP, updated.currentHP + item.heal);
              updated.currentHP = newHP;
              message = `${updated.name}ã®HPãŒ${item.heal}å›å¾©ã—ãŸï¼`;
            } else if (item.cure === 'all') {
              updated.status = null;
              message = `${updated.name}ã®çŠ¶æ…‹ç•°å¸¸ãŒå…¨ã¦æ²»ã£ãŸï¼`;
            } else if (item.cure) {
              if (updated.status === item.cure) {
                updated.status = null;
                const statusName = item.cure === 'poison' ? 'æ¯’' : item.cure === 'paralyze' ? 'éº»ç—º' : 'çœ ã‚Š';
                message = `${updated.name}ã®${statusName}ãŒæ²»ã£ãŸï¼`;
              } else {
                message = 'åŠ¹æœãŒãªã‹ã£ãŸ...';
              }
            }
            
            setPlayerMonster(updated);
            const newInventory = { ...inventory, [itemKey]: inventory[itemKey] - 1 };
            setInventory(newInventory);
            saveGame(updated, currentLocation, money, newInventory, defeatedRivals, completedEvents);
            
            if (screen === 'battle' && message) {
              setBattleLog(prev => [...prev, message]);
              setSelectedAction(null);
              setIsPlayerTurn(false);
              setTimeout(() => enemyAttack(), 1500);
            }
          };

          const runAway = () => {
            if (battleType !== 'wild') {
              setBattleLog(prev => [...prev, 'ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼æˆ¦ã§ã¯é€ƒã’ã‚‰ã‚Œãªã„ï¼']);
              return;
            }
            
            setSelectedAction('run');
            
            if (Math.random() < 0.5) {
              setBattleLog(prev => [...prev, 'ã†ã¾ãé€ƒã’åˆ‡ã‚ŒãŸï¼']);
              setTimeout(() => {
                setScreen('town');
                setIsAnimating(false);
                setSelectedAction(null);
              }, 1500);
            } else {
              setBattleLog(prev => [...prev, 'é€ƒã’ã‚‰ã‚Œãªã‹ã£ãŸï¼']);
              setIsPlayerTurn(false);
              setTimeout(() => enemyAttack(), 1500);
            }
          };

          const buyItem = (itemKey) => {
            const item = ITEMS[itemKey];
            if (money < item.price) return;
            
            const newMoney = money - item.price;
            const newInventory = { ...inventory, [itemKey]: (inventory[itemKey] || 0) + 1 };
            setMoney(newMoney);
            setInventory(newInventory);
            saveGame(playerMonster, currentLocation, newMoney, newInventory, defeatedRivals, completedEvents);
          };

          const healAtCenter = () => {
            const healed = { ...playerMonster, currentHP: playerMonster.maxHP, status: null };
            setPlayerMonster(healed);
            saveGame(healed, currentLocation, money, inventory, defeatedRivals, completedEvents);
          };

          const moveToLocation = (newLocation) => {
            setCurrentLocation(newLocation);
            saveGame(playerMonster, newLocation, money, inventory, defeatedRivals, completedEvents);
            setShowMap(false);
            setScreen('town');
          };

          const completeEvent = (eventId) => {
            const event = WORLD_MAP.events.find(e => e.id === eventId);
            if (!event || completedEvents.includes(eventId)) return;
            
            let newMoney = money;
            let newInventory = { ...inventory };
            
            if (event.reward) {
              if (event.reward.money) {
                newMoney += event.reward.money;
              }
              if (event.reward.item) {
                newInventory[event.reward.item] = (newInventory[event.reward.item] || 0) + event.reward.amount;
              }
            }
            
            const newCompletedEvents = [...completedEvents, eventId];
            setMoney(newMoney);
            setInventory(newInventory);
            setCompletedEvents(newCompletedEvents);
            saveGame(playerMonster, currentLocation, newMoney, newInventory, defeatedRivals, newCompletedEvents);
          };

          const resetGame = () => {
            if (window.confirm('æœ¬å½“ã«ã‚²ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ\nå…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ãŒå‰Šé™¤ã•ã‚Œã¾ã™ã€‚')) {
              localStorage.removeItem('monsterQuestSaveV3');
              window.location.reload();
            }
          };

          const getHPBarColor = (current, max) => {
            const percentage = (current / max) * 100;
            if (percentage > 50) return '#48D248';
            if (percentage > 25) return '#F8D030';
            return '#F85030';
          };

          const getTypeColor = (type) => {
            return {
              fire: '#F08030',
              water: '#6890F0',
              grass: '#78C850',
              normal: '#A8A878'
            }[type];
          };

          const getStatusIcon = (status) => {
            if (status === 'poison') return 'ğŸŸ£';
            if (status === 'paralyze') return 'âš¡';
            if (status === 'sleep') return 'ğŸ’¤';
            return '';
          };

          const getRarityColor = (rarity) => {
            return {
              common: '#9E9E9E',
              uncommon: '#4CAF50',
              rare: '#2196F3',
              legendary: '#FFD700'
            }[rarity];
          };

          // ============ ç”»é¢ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° ============

          // ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢
          if (screen === 'title') {
            return (
              <div style={{ 
                minHeight: '100vh', 
                background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                padding: '20px'
              }}>
                <div className="fade-in card" style={{ 
                  padding: '60px 40px',
                  textAlign: 'center',
                  maxWidth: '500px',
                  width: '100%'
                }}>
                  <div className="bounce" style={{ fontSize: '80px', marginBottom: '20px' }}>âš¡</div>
                  <h1 className="text-gradient" style={{ fontSize: '48px', margin: '0 0 15px 0', fontWeight: 'bold' }}>
                    Monster<br/>Quest
                  </h1>
                  <p style={{ fontSize: '18px', marginBottom: '50px', color: '#666' }}>
                    ç©¶æ¥µã®å†’é™ºãŒä»Šã€å§‹ã¾ã‚‹
                  </p>
                  <button
                    onClick={() => setScreen('select')}
                    className="button-press"
                    style={{
                      background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                      color: 'white',
                      border: 'none',
                      padding: '20px 60px',
                      fontSize: '22px',
                      borderRadius: '50px',
                      cursor: 'pointer',
                      fontWeight: 'bold',
                      boxShadow: '0 8px 20px rgba(102, 126, 234, 0.4)',
                      transition: 'all 0.3s',
                      width: '100%'
                    }}
                  >
                    å†’é™ºã‚’å§‹ã‚ã‚‹
                  </button>
                </div>
              </div>
            );
          }

          // ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼é¸æŠ
          if (screen === 'select') {
            const starters = [1, 4, 8, 11, 14, 18, 21, 24, 28];
            
            return (
              <div style={{ 
                minHeight: '100vh', 
                background: 'linear-gradient(to bottom, #a8edea 0%, #fed6e3 100%)',
                padding: '20px',
                overflowY: 'auto'
              }}>
                <div style={{ maxWidth: '1000px', margin: '0 auto' }}>
                  <div className="fade-in" style={{ textAlign: 'center', marginBottom: '40px' }}>
                    <h2 style={{ fontSize: '32px', marginBottom: '15px', color: '#333' }}>
                      é‹å‘½ã®ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚’é¸ã¼ã†
                    </h2>
                    <p style={{ fontSize: '16px', color: '#666' }}>
                      ãã¿ã¨ä¸€ç·’ã«å†’é™ºã™ã‚‹ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã‚’é¸ã‚“ã§ã­
                    </p>
                  </div>
                  <div style={{ 
                    display: 'grid', 
                    gridTemplateColumns: 'repeat(auto-fill, minmax(150px, 1fr))', 
                    gap: '20px',
                    marginBottom: '20px'
                  }}>
                    {starters.map((id, index) => {
                      const monster = MONSTER_DATABASE[id];
                      return (
                        <div
                          key={id}
                          onClick={() => selectStarter(id)}
                          className="fade-in card button-press"
                          style={{
                            padding: '20px 15px',
                            cursor: 'pointer',
                            textAlign: 'center',
                            transition: 'all 0.3s',
                            animationDelay: `${index * 0.1}s`
                          }}
                          onMouseEnter={(e) => {
                            e.currentTarget.style.transform = 'translateY(-10px)';
                            e.currentTarget.style.boxShadow = '0 15px 40px rgba(0,0,0,0.3)';
                          }}
                          onMouseLeave={(e) => {
                            e.currentTarget.style.transform = 'translateY(0)';
                            e.currentTarget.style.boxShadow = '0 10px 30px rgba(0,0,0,0.2)';
                          }}
                        >
                          <div className="monster-sprite" style={{
                            width: '100px',
                            height: '100px',
                            margin: '0 auto 15px',
                            background: `linear-gradient(135deg, ${getTypeColor(monster.type)}dd, ${getTypeColor(monster.type)})`,
                            borderRadius: '50%',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            fontSize: '60px',
                            border: `4px solid ${getRarityColor(monster.rarity)}`,
                            boxShadow: '0 4px 15px rgba(0,0,0,0.2)'
                          }}>
                            {monster.sprite}
                          </div>
                          <h3 style={{ margin: '10px 0', fontSize: '18px', fontWeight: 'bold' }}>
                            {monster.name}
                          </h3>
                          <div style={{
                            display: 'inline-block',
                            padding: '4px 12px',
                            background: getTypeColor(monster.type),
                            color: 'white',
                            borderRadius: '15px',
                            fontSize: '11px',
                            fontWeight: 'bold',
                            marginBottom: '8px'
                          }}>
                            {monster.type === 'fire' ? 'ğŸ”¥ã»ã®ãŠ' : monster.type === 'water' ? 'ğŸ’§ã¿ãš' : 'ğŸŒ¿ãã•'}
                          </div>
                          <p style={{ margin: '8px 0', fontSize: '11px', color: '#666' }}>
                            HP:{monster.baseHP} æ”»:{monster.baseAtk} é˜²:{monster.baseDef}
                          </p>
                        </div>
                      );
                    })}
                  </div>
                </div>
              </div>
            );
          }

          // ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚¤ãƒ³ãƒˆãƒ­
          if (screen === 'story-intro') {
            return (
              <div style={{ 
                minHeight: '100vh', 
                background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                padding: '20px'
              }}>
                <div className="fade-in card" style={{
                  padding: '50px 40px',
                  maxWidth: '650px',
                  width: '100%',
                  textAlign: 'center'
                }}>
                  <div style={{ fontSize: '80px', marginBottom: '30px' }}>ğŸŒŸ</div>
                  <h2 className="text-gradient" style={{ fontSize: '32px', marginBottom: '30px' }}>
                    å†’é™ºã®å§‹ã¾ã‚Š
                  </h2>
                  <p style={{ fontSize: '17px', lineHeight: '2', marginBottom: '20px', color: '#555' }}>
                    ãã¿ã¯{playerMonster.name}ã¨å‡ºä¼šã„ã€<br/>
                    å…±ã«æ—…ã‚’ã™ã‚‹ä»²é–“ã¨ãªã£ãŸã€‚
                  </p>
                  <p style={{ fontSize: '17px', lineHeight: '2', marginBottom: '20px', color: '#555' }}>
                    ä¸–ç•Œã«ã¯5ã¤ã®ç”ºãŒã‚ã‚Šã€<br/>
                    ãã‚Œãã‚Œã«å¼·åŠ›ãªãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼ãŒå¾…ã¡å—ã‘ã¦ã„ã‚‹ã€‚
                  </p>
                  <p style={{ fontSize: '17px', lineHeight: '2', marginBottom: '40px', color: '#555' }}>
                    æ§˜ã€…ãªé“ã‚’å†’é™ºã—ã€ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã‚’è‚²ã¦ã€<br/>
                    æœ€å¾Œã«ã¯ãƒãƒ£ãƒ³ãƒ”ã‚ªãƒ³ã«æŒ‘æˆ¦ã—ã‚ˆã†ï¼
                  </p>
                  <button
                    onClick={() => setScreen('town')}
                    className="button-press"
                    style={{
                      background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                      color: 'white',
                      border: 'none',
                      padding: '18px 50px',
                      fontSize: '20px',
                      borderRadius: '50px',
                      cursor: 'pointer',
                      fontWeight: 'bold',
                      width: '100%'
                    }}
                  >
                    å‡ºç™ºã™ã‚‹
                  </button>
                </div>
              </div>
            );
          }

          // ç”ºç”»é¢
          if (screen === 'town') {
            const currentTown = WORLD_MAP.towns.find(t => t.id === currentLocation);
            const availableRoutes = WORLD_MAP.routes.filter(r => r.from === currentLocation);
            const availableRivals = WORLD_MAP.rivals.filter(r => r.location === currentLocation && !defeatedRivals.includes(r.id));
            const availableEvents = WORLD_MAP.events.filter(e => e.location === currentLocation && !completedEvents.includes(e.id));
            
            return (
              <div style={{ 
                minHeight: '100vh', 
                background: 'linear-gradient(to bottom, #a8edea 0%, #fed6e3 100%)',
                padding: '15px',
                paddingBottom: '80px'
              }}>
                <div style={{ maxWidth: '700px', margin: '0 auto' }}>
                  {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
                  <div className="card" style={{ padding: '20px', marginBottom: '15px' }}>
                    <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '15px' }}>
                      <h2 style={{ fontSize: '26px', margin: 0, color: '#667eea' }}>
                        {currentTown.sprite} {currentTown.name}
                      </h2>
                      <button
                        onClick={() => setShowOptions(true)}
                        className="button-press"
                        style={{
                          background: '#9E9E9E',
                          color: 'white',
                          border: 'none',
                          padding: '10px 20px',
                          borderRadius: '20px',
                          cursor: 'pointer',
                          fontWeight: 'bold',
                          fontSize: '14px'
                        }}
                      >
                        âš™ï¸
                      </button>
                    </div>
                    <p style={{ fontSize: '14px', color: '#666', marginBottom: '15px' }}>
                      {currentTown.description}
                    </p>
                    <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '15px', fontSize: '15px' }}>
                      <div style={{ background: '#FFF9C4', padding: '12px', borderRadius: '10px', textAlign: 'center' }}>
                        <div style={{ fontSize: '20px', marginBottom: '5px' }}>ğŸ’°</div>
                        <div style={{ fontWeight: 'bold' }}>{money}å††</div>
                      </div>
                      <div style={{ background: '#E1F5FE', padding: '12px', borderRadius: '10px', textAlign: 'center' }}>
                        <div style={{ fontSize: '20px', marginBottom: '5px' }}>{playerMonster.sprite}</div>
                        <div style={{ fontWeight: 'bold' }}>Lv.{playerMonster.level}</div>
                      </div>
                    </div>
                  </div>

                  {/* ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼æƒ…å ± */}
                  <div className="card" style={{ padding: '20px', marginBottom: '15px' }}>
                    <div style={{ display: 'flex', gap: '15px', alignItems: 'center' }}>
                      <div className="monster-sprite pulse" style={{
                        width: '100px',
                        height: '100px',
                        background: `linear-gradient(135deg, ${getTypeColor(playerMonster.type)}dd, ${getTypeColor(playerMonster.type)})`,
                        borderRadius: '50%',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        fontSize: '70px',
                        border: `4px solid ${getRarityColor(playerMonster.rarity)}`,
                        boxShadow: '0 4px 15px rgba(0,0,0,0.2)',
                        flexShrink: 0
                      }}>
                        {playerMonster.sprite}
                      </div>
                      <div style={{ flex: 1 }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '8px' }}>
                          <h3 style={{ margin: 0, fontSize: '22px' }}>
                            {playerMonster.name} {getStatusIcon(playerMonster.status)}
                          </h3>
                          <span style={{ fontSize: '16px', fontWeight: 'bold' }}>Lv.{playerMonster.level}</span>
                        </div>
                        <div className="hp-bar-container" style={{ marginBottom: '8px' }}>
                          <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: '13px', marginBottom: '4px' }}>
                            <span>HP</span>
                            <span>{playerMonster.currentHP} / {playerMonster.maxHP}</span>
                          </div>
                          <div style={{ 
                            width: '100%', 
                            height: '22px', 
                            background: '#e0e0e0', 
                            borderRadius: '11px',
                            overflow: 'hidden',
                            border: '2px solid #999',
                            position: 'relative'
                          }}>
                            <div style={{ 
                              width: `${(playerMonster.currentHP / playerMonster.maxHP) * 100}%`,
                              height: '100%',
                              background: getHPBarColor(playerMonster.currentHP, playerMonster.maxHP),
                              transition: 'width 0.5s ease-out',
                              position: 'relative',
                              overflow: 'hidden'
                            }}>
                              <div className="hp-bar-shine"></div>
                            </div>
                          </div>
                        </div>
                        <div style={{ display: 'flex', gap: '10px', fontSize: '13px', color: '#666' }}>
                          <span>æ”»:{playerMonster.attack}</span>
                          <span>é˜²:{playerMonster.defense}</span>
                          <span>EXP:{playerMonster.exp}/{playerMonster.expToNext}</span>
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã‚»ãƒ³ã‚¿ãƒ¼ */}
                  <div className="card" style={{ padding: '20px', marginBottom: '15px' }}>
                    <h3 style={{ marginBottom: '12px', fontSize: '18px', display: 'flex', alignItems: 'center', gap: '8px' }}>
                      <span>ğŸ¥</span> ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã‚»ãƒ³ã‚¿ãƒ¼
                    </h3>
                    <button
                      onClick={healAtCenter}
                      disabled={playerMonster.currentHP === playerMonster.maxHP && !playerMonster.status}
                      className="button-press"
                      style={{
                        width: '100%',
                        background: playerMonster.currentHP === playerMonster.maxHP && !playerMonster.status 
                          ? '#ccc' 
                          : 'linear-gradient(135deg, #FF6B9D, #C06C84)',
                        color: 'white',
                        border: 'none',
                        padding: '14px',
                        fontSize: '16px',
                        borderRadius: '12px',
                        cursor: playerMonster.currentHP === playerMonster.maxHP && !playerMonster.status ? 'not-allowed' : 'pointer',
                        fontWeight: 'bold'
                      }}
                    >
                      ç„¡æ–™ã§å…¨å›å¾©
                    </button>
                  </div>

                  {/* ã‚¤ãƒ™ãƒ³ãƒˆ */}
                  {availableEvents.length > 0 && (
                    <div className="card slide-in" style={{ padding: '20px', marginBottom: '15px', background: 'linear-gradient(135deg, #FFF9C4, #FFEB3B)' }}>
                      <h3 style={{ marginBottom: '12px', fontSize: '18px' }}>âœ¨ ã‚¤ãƒ™ãƒ³ãƒˆ</h3>
                      {availableEvents.map(event => (
                        <div key={event.id} style={{
                          background: 'white',
                          padding: '15px',
                          borderRadius: '12px',
                          marginBottom: '10px'
                        }}>
                          <div style={{ fontSize: '40px', textAlign: 'center', marginBottom: '10px' }}>
                            {event.sprite}
                          </div>
                          <p style={{ fontSize: '14px', marginBottom: '12px', lineHeight: '1.6' }}>
                            <strong>{event.npc}:</strong> {event.message}
                          </p>
                          <button
                            onClick={() => completeEvent(event.id)}
                            className="button-press"
                            style={{
                              width: '100%',
                              background: 'linear-gradient(135deg, #667eea, #764ba2)',
                              color: 'white',
                              border: 'none',
                              padding: '12px',
                              borderRadius: '10px',
                              cursor: 'pointer',
                              fontWeight: 'bold'
                            }}
                          >
                            è©±ã—ã‹ã‘ã‚‹
                          </button>
                        </div>
                      ))}
                    </div>
                  )}

                  {/* ãƒ©ã‚¤ãƒãƒ« */}
                  {availableRivals.length > 0 && (
                    <div className="card" style={{ 
                      padding: '20px', 
                      marginBottom: '15px',
                      background: 'linear-gradient(135deg, #FFA07A, #FF6347)',
                      color: 'white'
                    }}>
                      <h3 style={{ marginBottom: '15px', fontSize: '18px' }}>âš”ï¸ ãƒãƒˆãƒ«</h3>
                      {availableRivals.map(rival => (
                        <button
                          key={rival.id}
                          onClick={() => startRivalBattle(rival.id)}
                          className="button-press"
                          style={{
                            width: '100%',
                            background: 'rgba(255,255,255,0.25)',
                            color: 'white',
                            border: '3px solid white',
                            padding: '18px',
                            fontSize: '16px',
                            borderRadius: '15px',
                            cursor: 'pointer',
                            fontWeight: 'bold',
                            marginBottom: '10px',
                            backdropFilter: 'blur(10px)'
                          }}
                        >
                          <div style={{ fontSize: '40px', marginBottom: '8px' }}>{rival.sprite}</div>
                          <div>{rival.name}</div>
                          <div style={{ fontSize: '13px', opacity: 0.9, marginTop: '5px' }}>
                            è³é‡‘: {rival.reward}å††
                          </div>
                        </button>
                      ))}
                    </div>
                  )}

                  {/* é“è·¯ */}
                  {availableRoutes.length > 0 && (
                    <div className="card" style={{ padding: '20px', marginBottom: '15px' }}>
                      <h3 style={{ marginBottom: '15px', fontSize: '18px' }}>ğŸ›£ï¸ å†’é™ºã™ã‚‹</h3>
                      {availableRoutes.map(route => (
                        <button
                          key={route.id}
                          onClick={() => startWildBattle(route.id)}
                          className="button-press"
                          style={{
                            width: '100%',
                            background: 'linear-gradient(135deg, #78C850, #5CA935)',
                            color: 'white',
                            border: 'none',
                            padding: '18px',
                            fontSize: '16px',
                            borderRadius: '15px',
                            cursor: 'pointer',
                            fontWeight: 'bold',
                            marginBottom: '10px',
                            boxShadow: '0 4px 12px rgba(0,0,0,0.2)'
                          }}
                        >
                          <div style={{ display: 'flex', alignItems: 'center', gap: '10px', justifyContent: 'center' }}>
                            <span style={{ fontSize: '24px' }}>{route.sprite}</span>
                            <span>{route.name}</span>
                          </div>
                          <div style={{ fontSize: '13px', opacity: 0.9, marginTop: '5px' }}>
                            Lv.{route.minLevel}ã€œ{route.maxLevel}
                          </div>
                        </button>
                      ))}
                    </div>
                  )}

                  {/* å›ºå®šãƒœã‚¿ãƒ³ */}
                  <div style={{
                    position: 'fixed',
                    bottom: 0,
                    left: 0,
                    right: 0,
                    background: 'white',
                    borderTop: '2px solid #e0e0e0',
                    padding: '15px',
                    display: 'grid',
                    gridTemplateColumns: '1fr 1fr',
                    gap: '10px',
                    boxShadow: '0 -4px 10px rgba(0,0,0,0.1)'
                  }}>
                    <button
                      onClick={() => setShowMap(true)}
                      className="button-press"
                      style={{
                        background: 'linear-gradient(135deg, #4A90E2, #357ABD)',
                        color: 'white',
                        border: 'none',
                        padding: '14px',
                        borderRadius: '12px',
                        cursor: 'pointer',
                        fontWeight: 'bold',
                        fontSize: '15px'
                      }}
                    >
                      ğŸ—ºï¸ ãƒãƒƒãƒ—
                    </button>
                    <button
                      onClick={() => setScreen('shop')}
                      className="button-press"
                      style={{
                        background: 'linear-gradient(135deg, #FFA726, #FB8C00)',
                        color: 'white',
                        border: 'none',
                        padding: '14px',
                        borderRadius: '12px',
                        cursor: 'pointer',
                        fontWeight: 'bold',
                        fontSize: '15px'
                      }}
                    >
                      ğŸª ã‚·ãƒ§ãƒƒãƒ—
                    </button>
                  </div>
                </div>

                {/* ãƒãƒƒãƒ—ãƒ¢ãƒ¼ãƒ€ãƒ« */}
                {showMap && (
                  <div style={{
                    position: 'fixed',
                    top: 0,
                    left: 0,
                    right: 0,
                    bottom: 0,
                    background: 'rgba(0,0,0,0.8)',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    zIndex: 1000,
                    padding: '20px'
                  }} onClick={() => setShowMap(false)}>
                    <div className="card fade-in" style={{ 
                      padding: '30px',
                      maxWidth: '600px',
                      width: '100%',
                      maxHeight: '80vh',
                      overflowY: 'auto'
                    }} onClick={(e) => e.stopPropagation()}>
                      <h2 style={{ marginBottom: '25px', textAlign: 'center', fontSize: '24px' }}>
                        ğŸ—ºï¸ ãƒ¯ãƒ¼ãƒ«ãƒ‰ãƒãƒƒãƒ—
                      </h2>
                      <div style={{ display: 'grid', gap: '15px' }}>
                        {WORLD_MAP.towns.map(town => {
                          const canVisit = 
                            town.id === currentLocation ||
                            (town.id === 'forest' && defeatedRivals.includes('rival1')) ||
                            (town.id === 'lake' && defeatedRivals.includes('rival2')) ||
                            (town.id === 'mountain' && defeatedRivals.includes('rival3')) ||
                            (town.id === 'castle' && defeatedRivals.includes('champion'));
                          
                          return (
                            <button
                              key={town.id}
                              onClick={() => canVisit ? moveToLocation(town.id) : null}
                              disabled={!canVisit}
                              className={canVisit ? 'button-press map-tile' : ''}
                              style={{
                                background: canVisit 
                                  ? (town.id === currentLocation 
                                    ? 'linear-gradient(135deg, #667eea, #764ba2)' 
                                    : 'linear-gradient(135deg, #4CAF50, #45a049)')
                                  : '#e0e0e0',
                                color: canVisit ? 'white' : '#999',
                                border: 'none',
                                padding: '20px',
                                borderRadius: '15px',
                                cursor: canVisit ? 'pointer' : 'not-allowed',
                                textAlign: 'left',
                                display: 'flex',
                                alignItems: 'center',
                                gap: '15px'
                              }}
                            >
                              <div style={{ fontSize: '40px' }}>{town.sprite}</div>
                              <div>
                                <div style={{ fontWeight: 'bold', fontSize: '18px', marginBottom: '5px' }}>
                                  {town.name} {town.id === currentLocation && '(ç¾åœ¨åœ°)'}
                                </div>
                                <div style={{ fontSize: '13px', opacity: 0.9 }}>
                                  {town.description}
                                </div>
                              </div>
                            </button>
                          );
                        })}
                      </div>
                      <button
                        onClick={() => setShowMap(false)}
                        className="button-press"
                        style={{
                          width: '100%',
                          marginTop: '20px',
                          background: '#999',
                          color: 'white',
                          border: 'none',
                          padding: '14px',
                          borderRadius: '12px',
                          cursor: 'pointer',
                          fontWeight: 'bold'
                        }}
                      >
                        é–‰ã˜ã‚‹
                      </button>
                    </div>
                  </div>
                )}

                {/* ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãƒ¢ãƒ¼ãƒ€ãƒ« */}
                {showOptions && (
                  <div style={{
                    position: 'fixed',
                    top: 0,
                    left: 0,
                    right: 0,
                    bottom: 0,
                    background: 'rgba(0,0,0,0.8)',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    zIndex: 1000,
                    padding: '20px'
                  }} onClick={() => setShowOptions(false)}>
                    <div className="card fade-in" style={{ 
                      padding: '30px',
                      maxWidth: '400px',
                      width: '100%'
                    }} onClick={(e) => e.stopPropagation()}>
                      <h2 style={{ marginBottom: '25px', textAlign: 'center', fontSize: '24px' }}>
                        âš™ï¸ ã‚ªãƒ—ã‚·ãƒ§ãƒ³
                      </h2>
                      <button
                        onClick={resetGame}
                        className="button-press"
                        style={{
                          width: '100%',
                          background: 'linear-gradient(135deg, #EF5350, #E53935)',
                          color: 'white',
                          border: 'none',
                          padding: '16px',
                          borderRadius: '12px',
                          cursor: 'pointer',
                          fontWeight: 'bold',
                          fontSize: '16px',
                          marginBottom: '15px'
                        }}
                      >
                        ğŸ”„ ã‚²ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
                      </button>
                      <button
                        onClick={() => setShowOptions(false)}
                        className="button-press"
                        style={{
                          width: '100%',
                          background: '#999',
                          color: 'white',
                          border: 'none',
                          padding: '14px',
                          borderRadius: '12px',
                          cursor: 'pointer',
                          fontWeight: 'bold'
                        }}
                      >
                        é–‰ã˜ã‚‹
                      </button>
                    </div>
                  </div>
                )}
              </div>
            );
          }

          // ã‚·ãƒ§ãƒƒãƒ—ç”»é¢
          if (screen === 'shop') {
            return (
              <div style={{ 
                minHeight: '100vh', 
                background: 'linear-gradient(to bottom, #a8edea 0%, #fed6e3 100%)',
                padding: '20px',
                paddingBottom: '100px'
              }}>
                <div style={{ maxWidth: '700px', margin: '0 auto' }}>
                  <div className="card" style={{ padding: '25px', marginBottom: '20px' }}>
                    <h2 style={{ marginBottom: '10px', fontSize: '26px', textAlign: 'center' }}>
                      ğŸª ã‚·ãƒ§ãƒƒãƒ—
                    </h2>
                    <p style={{ textAlign: 'center', color: '#666', marginBottom: '20px' }}>
                      æ‰€æŒé‡‘: <span style={{ fontSize: '20px', fontWeight: 'bold', color: '#FFA726' }}>{money}å††</span>
                    </p>
                    <div style={{ display: 'grid', gap: '12px' }}>
                      {Object.entries(ITEMS).map(([key, item]) => (
                        <div key={key} className="card" style={{
                          padding: '15px',
                          background: '#f5f5f5'
                        }}>
                          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                            <div style={{ flex: 1 }}>
                              <div style={{ fontWeight: 'bold', fontSize: '16px', marginBottom: '4px' }}>
                                {item.name}
                              </div>
                              <div style={{ fontSize: '13px', color: '#666', marginBottom: '4px' }}>
                                {item.description}
                              </div>
                              <div style={{ fontSize: '14px', color: '#FFA726', fontWeight: 'bold' }}>
                                {item.price}å††
                              </div>
                              <div style={{ fontSize: '12px', color: '#999', marginTop: '4px' }}>
                                æ‰€æŒ: {inventory[key] || 0}å€‹
                              </div>
                            </div>
                            <button
                              onClick={() => buyItem(key)}
                              disabled={money < item.price}
                              className="button-press"
                              style={{
                                background: money < item.price ? '#ccc' : 'linear-gradient(135deg, #4CAF50, #45a049)',
                                color: 'white',
                                border: 'none',
                                padding: '12px 20px',
                                borderRadius: '10px',
                                cursor: money < item.price ? 'not-allowed' : 'pointer',
                                fontWeight: 'bold',
                                fontSize: '14px',
                                marginLeft: '15px'
                              }}
                            >
                              è³¼å…¥
                            </button>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>

                  <button
                    onClick={() => setScreen('town')}
                    className="button-press"
                    style={{
                      width: '100%',
                      background: '#999',
                      color: 'white',
                      border: 'none',
                      padding: '16px',
                      borderRadius: '12px',
                      cursor: 'pointer',
                      fontWeight: 'bold',
                      fontSize: '16px'
                    }}
                  >
                    ç”ºã«æˆ»ã‚‹
                  </button>
                </div>
              </div>
            );
          }

          // ãƒãƒˆãƒ«ç”»é¢
          if (screen === 'battle') {
            return (
              <div style={{ 
                minHeight: '100vh', 
                background: 'linear-gradient(to bottom, #FFE5B4, #FFD700)',
                padding: '15px',
                paddingBottom: '20px'
              }}>
                <div style={{ maxWidth: '800px', margin: '0 auto' }}>
                  {/* æ•µãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ */}
                  <div style={{ 
                    display: 'flex', 
                    justifyContent: 'flex-end',
                    marginBottom: '30px',
                    paddingRight: '20px'
                  }}>
                    <div className="fade-in">
                      <div className="card" style={{
                        padding: '15px',
                        marginBottom: '15px',
                        minWidth: '280px',
                        boxShadow: '0 6px 15px rgba(0,0,0,0.2)'
                      }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '10px', alignItems: 'center' }}>
                          <span style={{ fontWeight: 'bold', fontSize: '18px' }}>
                            {enemyMonster.name} {getStatusIcon(enemyMonster.status)}
                          </span>
                          <span style={{ fontSize: '16px' }}>Lv.{enemyMonster.level}</span>
                        </div>
                        <div style={{ marginBottom: '5px', display: 'flex', justifyContent: 'space-between', fontSize: '14px' }}>
                          <span>HP:</span>
                          <span>{enemyMonster.currentHP} / {enemyMonster.maxHP}</span>
                        </div>
                        <div className="hp-bar-container" style={{ 
                          width: '100%', 
                          height: '24px', 
                          background: '#e0e0e0', 
                          borderRadius: '12px',
                          overflow: 'hidden',
                          border: '2px solid #999',
                          position: 'relative'
                        }}>
                          <div style={{ 
                            width: `${(enemyMonster.currentHP / enemyMonster.maxHP) * 100}%`,
                            height: '100%',
                            background: getHPBarColor(enemyMonster.currentHP, enemyMonster.maxHP),
                            transition: 'width 0.5s ease-out',
                            position: 'relative',
                            overflow: 'hidden'
                          }}>
                            <div className="hp-bar-shine"></div>
                          </div>
                        </div>
                      </div>
                      <div className={damageFlash === 'enemy' ? 'shake' : ''} style={{
                        width: '180px',
                        height: '180px',
                        background: damageFlash === 'enemy' 
                          ? 'radial-gradient(circle, #ff0000 0%, #ff000080 100%)' 
                          : `linear-gradient(135deg, ${getTypeColor(enemyMonster.type)}dd, ${getTypeColor(enemyMonster.type)})`,
                        borderRadius: '50%',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        fontSize: '120px',
                        transition: 'all 0.3s',
                        margin: '0 auto',
                        border: `4px solid ${getRarityColor(enemyMonster.rarity)}`,
                        boxShadow: damageFlash === 'enemy' 
                          ? '0 0 40px rgba(255,0,0,0.9)' 
                          : '0 8px 20px rgba(0,0,0,0.3)'
                      }}>
                        {enemyMonster.sprite}
                      </div>
                    </div>
                  </div>

                  {/* å‘³æ–¹ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ */}
                  <div style={{ 
                    display: 'flex', 
                    justifyContent: 'flex-start',
                    marginBottom: '25px',
                    paddingLeft: '20px'
                  }}>
                    <div className="fade-in">
                      <div className={damageFlash === 'player' ? 'shake' : ''} style={{
                        width: '180px',
                        height: '180px',
                        background: damageFlash === 'player' 
                          ? 'radial-gradient(circle, #ff0000 0%, #ff000080 100%)' 
                          : `linear-gradient(135deg, ${getTypeColor(playerMonster.type)}dd, ${getTypeColor(playerMonster.type)})`,
                        borderRadius: '50%',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        fontSize: '120px',
                        transition: 'all 0.3s',
                        margin: '0 auto 15px',
                        border: `4px solid ${getRarityColor(playerMonster.rarity)}`,
                        boxShadow: damageFlash === 'player' 
                          ? '0 0 40px rgba(255,0,0,0.9)' 
                          : '0 8px 20px rgba(0,0,0,0.3)'
                      }}>
                        {playerMonster.sprite}
                      </div>
                      <div className="card" style={{
                        padding: '15px',
                        minWidth: '280px',
                        boxShadow: '0 6px 15px rgba(0,0,0,0.2)'
                      }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '10px', alignItems: 'center' }}>
                          <span style={{ fontWeight: 'bold', fontSize: '18px' }}>
                            {playerMonster.name} {getStatusIcon(playerMonster.status)}
                          </span>
                          <span style={{ fontSize: '16px' }}>Lv.{playerMonster.level}</span>
                        </div>
                        <div style={{ marginBottom: '5px', display: 'flex', justifyContent: 'space-between', fontSize: '14px' }}>
                          <span>HP:</span>
                          <span>{playerMonster.currentHP} / {playerMonster.maxHP}</span>
                        </div>
                        <div className="hp-bar-container" style={{ 
                          width: '100%', 
                          height: '24px', 
                          background: '#e0e0e0', 
                          borderRadius: '12px',
                          overflow: 'hidden',
                          marginBottom: '10px',
                          border: '2px solid #999',
                          position: 'relative'
                        }}>
                          <div style={{ 
                            width: `${(playerMonster.currentHP / playerMonster.maxHP) * 100}%`,
                            height: '100%',
                            background: getHPBarColor(playerMonster.currentHP, playerMonster.maxHP),
                            transition: 'width 0.5s ease-out',
                            position: 'relative',
                            overflow: 'hidden'
                          }}>
                            <div className="hp-bar-shine"></div>
                          </div>
                        </div>
                        <div style={{ marginBottom: '5px', display: 'flex', justifyContent: 'space-between', fontSize: '12px' }}>
                          <span>EXP:</span>
                          <span>{playerMonster.exp} / {playerMonster.expToNext}</span>
                        </div>
                        <div style={{ 
                          width: '100%', 
                          height: '14px', 
                          background: '#e0e0e0', 
                          borderRadius: '7px',
                          overflow: 'hidden',
                          border: '2px solid #999'
                        }}>
                          <div style={{ 
                            width: `${(playerMonster.exp / playerMonster.expToNext) * 100}%`,
                            height: '100%',
                            background: '#4A90E2',
                            transition: 'width 0.5s ease-out'
                          }} />
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* ãƒãƒˆãƒ«ãƒ­ã‚° */}
                  <div ref={battleLogRef} className="card" style={{
                    padding: '20px',
                    marginBottom: '20px',
                    minHeight: '130px',
                    maxHeight: '150px',
                    overflowY: 'auto',
                    fontSize: '15px',
                    lineHeight: '1.8',
                    boxShadow: '0 4px 12px rgba(0,0,0,0.15)'
                  }}>
                    {battleLog.slice(-6).map((log, idx) => (
                      <p key={idx} className="fade-in" style={{ 
                        margin: '6px 0',
                        fontWeight: log.includes('åŠ¹æœã¯') || log.includes('ãƒ€ãƒ¡ãƒ¼ã‚¸') ? 'bold' : 'normal',
                        color: log.includes('åŠ¹æœã¯æŠœç¾¤') ? '#E74C3C' : log.includes('ã„ã¾ã²ã¨ã¤') ? '#95A5A6' : '#333'
                      }}>{log}</p>
                    ))}
                  </div>

                  {/* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³é¸æŠ */}
                  {!selectedAction && (
                    <div className="fade-in" style={{
                      display: 'grid',
                      gridTemplateColumns: '1fr 1fr',
                      gap: '15px',
                      marginBottom: '15px'
                    }}>
                      <button
                        onClick={() => setSelectedAction('fight')}
                        disabled={!isPlayerTurn || isAnimating}
                        className="button-press"
                        style={{
                          background: !isPlayerTurn || isAnimating 
                            ? '#ccc' 
                            : 'linear-gradient(135deg, #EF5350, #E53935)',
                          color: 'white',
                          border: 'none',
                          padding: '20px',
                          fontSize: '18px',
                          borderRadius: '15px',
                          cursor: !isPlayerTurn || isAnimating ? 'not-allowed' : 'pointer',
                          fontWeight: 'bold',
                          boxShadow: !isPlayerTurn || isAnimating ? 'none' : '0 4px 10px rgba(0,0,0,0.2)'
                        }}
                      >
                        âš”ï¸ ãŸãŸã‹ã†
                      </button>
                      <button
                        onClick={() => setScreen('battle-item')}
                        disabled={!isPlayerTurn || isAnimating}
                        className="button-press"
                        style={{
                          background: !isPlayerTurn || isAnimating 
                            ? '#ccc' 
                            : 'linear-gradient(135deg, #FFA726, #FB8C00)',
                          color: 'white',
                          border: 'none',
                          padding: '20px',
                          fontSize: '18px',
                          borderRadius: '15px',
                          cursor: !isPlayerTurn || isAnimating ? 'not-allowed' : 'pointer',
                          fontWeight: 'bold',
                          boxShadow: !isPlayerTurn || isAnimating ? 'none' : '0 4px 10px rgba(0,0,0,0.2)'
                        }}
                      >
                        ğŸ’¼ ã©ã†ã
                      </button>
                      <button
                        onClick={runAway}
                        disabled={!isPlayerTurn || isAnimating || battleType !== 'wild'}
                        className="button-press"
                        style={{
                          background: !isPlayerTurn || isAnimating || battleType !== 'wild' 
                            ? '#ccc' 
                            : 'linear-gradient(135deg, #9E9E9E, #757575)',
                          color: 'white',
                          border: 'none',
                          padding: '20px',
                          fontSize: '18px',
                          borderRadius: '15px',
                          cursor: !isPlayerTurn || isAnimating || battleType !== 'wild' ? 'not-allowed' : 'pointer',
                          fontWeight: 'bold',
                          gridColumn: 'span 2',
                          boxShadow: !isPlayerTurn || isAnimating || battleType !== 'wild' ? 'none' : '0 4px 10px rgba(0,0,0,0.2)'
                        }}
                      >
                        ğŸƒ ã«ã’ã‚‹
                      </button>
                    </div>
                  )}

                  {/* æŠ€é¸æŠ */}
                  {selectedAction === 'fight' && (
                    <div className="slide-in" style={{
                      display: 'grid',
                      gridTemplateColumns: '1fr 1fr',
                      gap: '12px',
                      marginBottom: '15px'
                    }}>
                      {playerMonster.moves.map((move, idx) => {
                        const moveTypeColor = getTypeColor(move.type);
                        return (
                          <button
                            key={idx}
                            onClick={() => playerAttack(move)}
                            disabled={!isPlayerTurn || isAnimating}
                            className="button-press"
                            style={{
                              background: !isPlayerTurn || isAnimating 
                                ? '#ccc' 
                                : `linear-gradient(135deg, ${moveTypeColor} 0%, ${moveTypeColor}dd 100%)`,
                              color: 'white',
                              border: 'none',
                              padding: '16px',
                              fontSize: '15px',
                              borderRadius: '12px',
                              cursor: !isPlayerTurn || isAnimating ? 'not-allowed' : 'pointer',
                              fontWeight: 'bold',
                              textAlign: 'left',
                              boxShadow: !isPlayerTurn || isAnimating ? 'none' : '0 4px 8px rgba(0,0,0,0.2)',
                              transition: 'all 0.2s'
                            }}
                          >
                            <div style={{ fontSize: '16px', marginBottom: '6px', display: 'flex', alignItems: 'center', gap: '8px' }}>
                              <span>{move.type === 'fire' ? 'ğŸ”¥' : move.type === 'water' ? 'ğŸ’§' : move.type === 'grass' ? 'ğŸŒ¿' : 'â­'}</span>
                              <span>{move.name}</span>
                            </div>
                            <div style={{ fontSize: '13px', opacity: 0.9 }}>
                              å¨åŠ›: {move.power || 'âˆ’'}
                            </div>
                          </button>
                        );
                      })}
                      <button
                        onClick={() => setSelectedAction(null)}
                        className="button-press"
                        style={{
                          background: '#999',
                          color: 'white',
                          border: 'none',
                          padding: '16px',
                          borderRadius: '12px',
                          cursor: 'pointer',
                          fontWeight: 'bold',
                          gridColumn: 'span 2'
                        }}
                      >
                        â† ã‚‚ã©ã‚‹
                      </button>
                    </div>
                  )}
                </div>
              </div>
            );
          }

          // ã‚¢ã‚¤ãƒ†ãƒ ä½¿ç”¨ç”»é¢
          if (screen === 'battle-item') {
            return (
              <div style={{ 
                minHeight: '100vh', 
                background: 'linear-gradient(to bottom, #FFE5B4, #FFD700)',
                padding: '20px'
              }}>
                <div style={{ maxWidth: '600px', margin: '0 auto' }}>
                  <div className="card fade-in" style={{
                    padding: '25px',
                    boxShadow: '0 6px 15px rgba(0,0,0,0.2)'
                  }}>
                    <h2 style={{ marginBottom: '20px', fontSize: '24px', textAlign: 'center' }}>
                      ğŸ’¼ ã©ã†ãã‚’ä½¿ã†
                    </h2>
                    <div style={{ display: 'grid', gap: '12px', marginBottom: '20px' }}>
                      {Object.entries(ITEMS).filter(([key]) => inventory[key] > 0).map(([key, item]) => (
                        <button
                          key={key}
                          onClick={() => {
                            useItem(key);
                            setScreen('battle');
                          }}
                          className="button-press"
                          style={{
                            display: 'flex',
                            justifyContent: 'space-between',
                            alignItems: 'center',
                            padding: '16px',
                            background: '#f5f5f5',
                            border: '3px solid #333',
                            borderRadius: '12px',
                            cursor: 'pointer',
                            textAlign: 'left',
                            fontSize: '15px'
                          }}
                        >
                          <div>
                            <div style={{ fontWeight: 'bold', marginBottom: '5px' }}>{item.name}</div>
                            <div style={{ fontSize: '13px', color: '#666' }}>{item.description}</div>
                          </div>
                          <div style={{ fontWeight: 'bold', fontSize: '18px' }}>Ã—{inventory[key]}</div>
                        </button>
                      ))}
                      {Object.keys(inventory).filter(key => inventory[key] > 0).length === 0 && (
                        <p style={{ textAlign: 'center', color: '#999', padding: '30px', fontSize: '16px' }}>
                          ä½¿ãˆã‚‹ã‚¢ã‚¤ãƒ†ãƒ ãŒã‚ã‚Šã¾ã›ã‚“
                        </p>
                      )}
                    </div>
                    <button
                      onClick={() => setScreen('battle')}
                      className="button-press"
                      style={{
                        width: '100%',
                        background: '#999',
                        color: 'white',
                        border: 'none',
                        padding: '14px',
                        fontSize: '16px',
                        borderRadius: '12px',
                        cursor: 'pointer',
                        fontWeight: 'bold'
                      }}
                    >
                      ã‚‚ã©ã‚‹
                    </button>
                  </div>
                </div>
              </div>
            );
          }

          // é€²åŒ–ç”»é¢
          if (showEvolution) {
            return (
              <div style={{ 
                minHeight: '100vh', 
                background: 'linear-gradient(to bottom, #1a1a2e, #16213e)',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                color: 'white',
                padding: '20px'
              }}>
                <div style={{ textAlign: 'center' }} className="fade-in">
                  <h1 className="pulse" style={{ fontSize: '48px', marginBottom: '50px' }}>
                    âœ¨ é€²åŒ–ä¸­... âœ¨
                  </h1>
                  <div className="bounce" style={{
                    width: '200px',
                    height: '200px',
                    background: `linear-gradient(135deg, ${getTypeColor(evolutionData.from.type)}dd, ${getTypeColor(evolutionData.from.type)})`,
                    borderRadius: '50%',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    fontSize: '140px',
                    margin: '0 auto 40px',
                    border: `4px solid ${getRarityColor(evolutionData.from.rarity)}`,
                    boxShadow: '0 10px 30px rgba(255,255,255,0.3)'
                  }}>
                    {evolutionData.from.sprite}
                  </div>
                  <p style={{ fontSize: '32px', marginBottom: '30px', fontWeight: 'bold' }}>
                    {evolutionData.from.name}
                  </p>
                  <p className="pulse" style={{ fontSize: '60px', margin: '30px 0' }}>â†“</p>
                  <div className="bounce glow" style={{
                    width: '200px',
                    height: '200px',
                    background: `linear-gradient(135deg, ${getTypeColor(evolutionData.to.type)}dd, ${getTypeColor(evolutionData.to.type)})`,
                    borderRadius: '50%',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    fontSize: '140px',
                    margin: '0 auto 40px',
                    border: `4px solid ${getRarityColor(evolutionData.to.rarity)}`,
                    boxShadow: '0 10px 30px rgba(255,215,0,0.5)'
                  }}>
                    {evolutionData.to.sprite}
                  </div>
                  <p style={{ fontSize: '36px', fontWeight: 'bold', color: '#FFD700' }}>
                    {evolutionData.to.name}
                  </p>
                </div>
              </div>
            );
          }

          // ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°
          if (screen === 'ending') {
            return (
              <div style={{ 
                minHeight: '100vh', 
                background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                padding: '20px'
              }}>
                <div className="card fade-in" style={{
                  padding: '60px 40px',
                  maxWidth: '650px',
                  width: '100%',
                  textAlign: 'center'
                }}>
                  <div className="bounce" style={{ fontSize: '100px', marginBottom: '30px' }}>ğŸ†</div>
                  <h1 style={{ fontSize: '48px', marginBottom: '25px', color: '#FFD700', fontWeight: 'bold' }}>
                    ãŠã‚ã§ã¨ã†ï¼
                  </h1>
                  <p style={{ fontSize: '22px', marginBottom: '20px', lineHeight: '1.8' }}>
                    ãã¿ã¯å…¨ã¦ã®ãƒ©ã‚¤ãƒãƒ«ã‚’å€’ã—ã€<br/>
                    ã“ã®ä¸–ç•Œã®ãƒãƒ£ãƒ³ãƒ”ã‚ªãƒ³ã¨ãªã£ãŸï¼
                  </p>
                  <div style={{
                    background: 'linear-gradient(135deg, #FFF9C4, #FFEB3B)',
                    padding: '25px',
                    borderRadius: '15px',
                    marginBottom: '25px'
                  }}>
                    <div className="bounce" style={{
                      width: '120px',
                      height: '120px',
                      background: `linear-gradient(135deg, ${getTypeColor(playerMonster.type)}dd, ${getTypeColor(playerMonster.type)})`,
                      borderRadius: '50%',
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center',
                      fontSize: '90px',
                      margin: '0 auto 15px',
                      border: `4px solid ${getRarityColor(playerMonster.rarity)}`,
                      boxShadow: '0 8px 20px rgba(0,0,0,0.3)'
                    }}>
                      {playerMonster.sprite}
                    </div>
                    <p style={{ fontSize: '20px', fontWeight: 'bold', marginBottom: '10px' }}>
                      {playerMonster.name} Lv.{playerMonster.level}
                    </p>
                    <p style={{ fontSize: '16px', color: '#666' }}>
                      ç·ç²å¾—è³é‡‘: {money}å††
                    </p>
                  </div>
                  <p style={{ fontSize: '17px', marginBottom: '40px', lineHeight: '1.8', color: '#666' }}>
                    ç´ æ™´ã‚‰ã—ã„å†’é™ºã ã£ãŸï¼<br/>
                    ã‚ã‚ŠãŒã¨ã†ã€ãã—ã¦ã¾ãŸä¼šãŠã†ï¼
                  </p>
                  <button
                    onClick={resetGame}
                    className="button-press pulse"
                    style={{
                      background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                      color: 'white',
                      border: 'none',
                      padding: '20px 60px',
                      fontSize: '22px',
                      borderRadius: '50px',
                      cursor: 'pointer',
                      fontWeight: 'bold',
                      boxShadow: '0 8px 20px rgba(102, 126, 234, 0.4)',
                      width: '100%'
                    }}
                  >
                    æœ€åˆã‹ã‚‰éŠã¶
                  </button>
                </div>
              </div>
            );
          }

          // ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼
          if (screen === 'gameover') {
            return (
              <div style={{ 
                minHeight: '100vh', 
                background: 'linear-gradient(to bottom, #2c2c2c, #1a1a1a)',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                padding: '20px'
              }}>
                <div className="card fade-in" style={{ 
                  padding: '60px 40px',
                  textAlign: 'center',
                  maxWidth: '500px',
                  width: '100%'
                }}>
                  <h1 style={{ fontSize: '48px', margin: '0 0 30px 0', color: '#F85030' }}>
                    GAME OVER
                  </h1>
                  <p style={{ fontSize: '20px', marginBottom: '15px' }}>
                    {playerMonster.name}ã¯åŠ›å°½ããŸ...
                  </p>
                  <p style={{ fontSize: '16px', marginBottom: '40px', color: '#666' }}>
                    æ‰€æŒé‡‘: {money}å††
                  </p>
                  <button
                    onClick={() => {
                      healAtCenter();
                      setScreen('town');
                    }}
                    className="button-press"
                    style={{
                      width: '100%',
                      background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                      color: 'white',
                      border: 'none',
                      padding: '18px 40px',
                      fontSize: '18px',
                      borderRadius: '25px',
                      cursor: 'pointer',
                      fontWeight: 'bold',
                      marginBottom: '15px'
                    }}
                  >
                    ç”ºã«æˆ»ã‚‹
                  </button>
                  <button
                    onClick={resetGame}
                    className="button-press"
                    style={{
                      width: '100%',
                      background: '#999',
                      color: 'white',
                      border: 'none',
                      padding: '14px',
                      fontSize: '16px',
                      borderRadius: '20px',
                      cursor: 'pointer'
                    }}
                  >
                    æœ€åˆã‹ã‚‰
                  </button>
                </div>
              </div>
            );
          }

          return null;
        };

        ReactDOM.render(<MonsterQuest />, document.getElementById('root'));
    </script>
</body>
</html>
